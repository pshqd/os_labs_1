# libcaesar — XOR Encryption Library

Динамическая библиотека на C++ для побайтового XOR-шифрования.  
Учебный проект по курсу «Операционные системы».

---

## Структура проекта

```text
libcaesar/
├── caesar.cpp        # Исходный код библиотеки (C++)
├── Makefile          # Сборка, установка, тест
├── test_caesar.py    # Тестовая программа (Python, динамическая загрузка)
├── input.txt         # Входной файл для теста
├── output.txt        # Результат шифрования (генерируется автоматически)
└── libcaesar.so      # Скомпилированная библиотека (генерируется автоматически)
```

---

## Описание

Библиотека реализует симметричное шифрование на основе операции XOR.  
Поскольку `A XOR K XOR K = A`, одна и та же функция используется  
как для шифрования, так и для дешифрования.

### Экспортируемые функции

```c
void set_key(char key);
void caesar(void* src, void* dst, int len);
```

| Функция | Описание |
|---|---|
| `set_key(key)` | Устанавливает ключ шифрования. Ключ хранится внутри библиотеки в статической переменной |
| `caesar(src, dst, len)` | Применяет XOR к `len` байтам из буфера `src`, записывает результат в `dst`. Буферы `src` и `dst` могут совпадать |

---

## Сборка и запуск

### Требования

- macOS или Linux
- `g++` / `clang++`
- `python3`
- `make`

### Команды

```bash
# Скомпилировать библиотеку → libcaesar.so
make

# Установить библиотеку в /usr/local/lib
sudo make install

# Запустить тест
make test
```

### Параметры теста (Makefile)

| Параметр | Значение по умолчанию | Описание |
|---|---|---|
| `INPUT` | `input.txt` | Входной файл |
| `OUTPUT` | `output.txt` | Файл с зашифрованными данными |
| `KEY` | `42` | Ключ шифрования (0–255) |

Изменить ключ или файлы можно прямо в вызове:
```bash
make test KEY=99 INPUT=secret.txt OUTPUT=secret.enc
```

---

## Пример вывода

```
----------------------------------------
ORIGINAL  (original):
Hello, XOR Caesar! 1234 binary test.
----------------------------------------
ENCRYPTED (encoded),  key=42:
62 4f 56 56 55 04 7a 59 48 2f 69 4f 55 73 4b ...
----------------------------------------
DECRYPTED (decoded):
Hello, XOR Caesar! 1234 binary test.
----------------------------------------
[OK] Проверка двойного XOR пройдена: decrypted == original
```

---

## Тестовая программа

`test_caesar.py` загружает библиотеку **динамически во время выполнения**  
через `ctypes.CDLL` — без статической линковки на этапе компиляции.

Запуск вручную:
```bash
python3 test_caesar.py ./libcaesar.so 42 input.txt output.txt
```

Аргументы:
1. Путь к библиотеке `.so`
2. Ключ шифрования (целое число)
3. Входной файл
4. Выходной файл

---

## Флаги компиляции

```makefile
-Wall -Wextra -pedantic   # максимум предупреждений
-fPIC                     # position-independent code (обязательно для .so)
-shared                   # создать динамическую библиотеку
```

---
